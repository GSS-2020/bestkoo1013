<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Titik Kertas Matematik</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Titik Kertas">
</head>
<body>
    <div class="container">
        <h1>Game Titik Kertas Matematik</h1>
        
        <!-- Dashboard Statistik -->
        <div class="stats-dashboard" id="stats-dashboard" style="display: none;">
            <h3>ğŸ“Š Dashboard Statistik</h3>
            <div class="player-stats">
                <div class="stat-card">
                    <h4 id="player1-stat-name">Pemain 1</h4>
                    <div class="wins-count">
                        <span class="wins-number" id="player1-wins">0</span>
                        <span class="wins-label">Kemenangan</span>
                    </div>
                </div>
                <div class="stat-card">
                    <h4 id="player2-stat-name">Pemain 2</h4>
                    <div class="wins-count">
                        <span class="wins-number" id="player2-wins">0</span>
                        <span class="wins-label">Kemenangan</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="game-info">
            <div class="player-turn">
                <span id="current-player">Pemain 1 (Hitam)</span>
            </div>
            <div class="scores">
                <div class="score" id="score1">
                    <span>Pemain 1 (Hitam): </span>
                    <span id="player1-score">0</span>
                    <span> dikepung</span>
                </div>
                <div class="score" id="score2">
                    <span>Pemain 2 (Merah): </span>
                    <span id="player2-score">0</span>
                    <span> dikepung</span>
                </div>
            </div>
            <div class="leading-indicator" id="leading-indicator">
                Seri - Tiada pemimpin
            </div>
        </div>
        
        <div class="game-board" id="game-board">
            <!-- Grid akan dibuat oleh JavaScript -->
        </div>
        
        <div class="controls">
            <button id="new-game" onclick="startNewGame()">Permainan Baru</button>
            <button id="reset-game" onclick="resetGameAndPlayers()">Reset & Tukar Nama</button>
            <button id="clear-stats" onclick="clearStatistics()">Kosongkan Statistik</button>
        </div>
        
        <!-- Install/Download Button -->
        <button class="install-button" id="install-button" onclick="installApp()" title="Install Game" style="display: none;">
            ğŸ“± Install Game
        </button>
        
        <!-- Full Screen Toggle Button -->
        <button class="fullscreen-toggle" onclick="toggleFullScreen()" title="Toggle Full Screen">
            ğŸ”³
        </button>
        
        <!-- Sound Control Button -->
        <button class="sound-toggle" onclick="toggleSound()" title="Toggle Sound Effects">
            ğŸ”Š
        </button>
        
        <div class="instructions">
            <h3>Cara Bermain:</h3>
            <div class="instructions-content">
                <h4>ğŸ“± Install Game (PWA):</h4>
                <ul>
                    <li><strong>Klik tombol "ğŸ“± Install Game"</strong> di pojok kiri atas untuk install sebagai app</li>
                    <li><strong>Android:</strong> Menu browser â†’ "Add to Home Screen" atau "Install App"</li>
                    <li><strong>iOS Safari:</strong> Share button (â¬†ï¸) â†’ "Add to Home Screen"</li>
                    <li><strong>Desktop:</strong> Icon install di address bar atau menu browser</li>
                    <li><strong>Offline Gaming:</strong> Setelah install, game boleh dimain tanpa internet!</li>
                </ul>
                
                <h4>ğŸ¯ Objektif Permainan:</h4>
                <p>Kepung titik lawan dengan menggunakan strategi dan perangkap untuk mencapai skor tertinggi!</p>
                
                <h4>ğŸ“‹ Peraturan Asas:</h4>
                <ul>
                    <li><strong>Pemain 1 (Hitam)</strong> dan <strong>Pemain 2 (Merah)</strong> bergilir-gilir</li>
                    <li>Klik pada titik persimpangan (L1-L9, B1-B9) untuk meletakkan titik anda</li>
                    <li>Titik yang sudah ditempatkan tidak boleh digantikan</li>
                    <li>Pemain yang mencapai <strong>skor kemenangan</strong> (10/12/14 kepungan) menang!</li>
                </ul>
                
                <h4>âš”ï¸ Sistem Kepungan:</h4>
                <ul>
                    <li><strong>Kepung Biasa:</strong> Kelilingi titik lawan dengan <strong>4 atau lebih</strong> titik anda</li>
                    <li>Titik yang dikepung akan ditandai dengan âœ– dan dikira sebagai skor</li>
                    <li>Garisan akan muncul menghubungkan titik-titik yang membuat kepungan</li>
                </ul>
                
                <h4>ğŸ”„ Sistem Counter-Capture (Baru!):</h4>
                <ul>
                    <li><strong>Risiko Kepungan:</strong> Titik yang berjaya kepung lawan juga boleh dikepung balik!</li>
                    <li><strong>Strategi Berisiko:</strong> Setiap kepungan membuka peluang counter-attack</li>
                    <li><strong>Timing Penting:</strong> System check kedua-dua pemain selepas setiap move</li>
                    <li><strong>Double Strategy:</strong> Kena fikir attack dan defense serentak!</li>
                </ul>
                
                <h4>ğŸ­ Sistem Perangkap Tersembunyi:</h4>
                <ul>
                    <li><strong>Cipta Perangkap:</strong> Kelilingi kawasan kosong dengan <strong>4 atau lebih</strong> titik anda</li>
                    <li><strong>Perangkap Tersembunyi:</strong> Lawan tidak dapat melihat kawasan perangkap</li>
                    <li><strong>Aktivasi:</strong> Bila lawan meletakkan titik dalam perangkap, titik itu automatik ditawan!</li>
                    <li><strong>Garisan Dramatik:</strong> Garisan kepungan akan muncul menghubungkan titik-titik perangkap yang diaktifkan</li>
                </ul>
                
                <h4>ğŸ† Cara Menang:</h4>
                <ul>
                    <li><strong>Easy Mode:</strong> 10 kepungan untuk menang</li>
                    <li><strong>Medium Mode:</strong> 12 kepungan untuk menang</li>
                    <li><strong>Hard Mode:</strong> 14 kepungan untuk menang</li>
                    <li>Jika papan penuh, pemain dengan skor tertinggi menang</li>
                    <li>Gunakan gabungan kepungan, counter-capture dan perangkap untuk strategi terbaik!</li>
                </ul>
                
                <h4>ğŸ’¡ Tips Strategi:</h4>
                <ul>
                    <li><strong>Perangkap Awal:</strong> Buat perangkap kecil di sudut untuk peluang mudah</li>
                    <li><strong>Jebak Ganda:</strong> Cipta beberapa perangkap untuk membingungkan lawan</li>
                    <li><strong>Pertahanan:</strong> Jangan biarkan lawan kelilingi titik anda</li>
                    <li><strong>Serangan Berisiko:</strong> Kepung lawan tapi jaga jangan kena counter-capture!</li>
                    <li><strong>Positioning:</strong> Letakkan titik strategik yang sukar dikepung balik</li>
                </ul>
                
                <h4>ğŸ® Kontrol Game:</h4>
                <ul>
                    <li><strong>ğŸ”³ Full Screen:</strong> Klik untuk mode full screen gaming</li>
                    <li><strong>ğŸ”Š Sound:</strong> Toggle sound effects on/off</li>
                    <li><strong>ğŸ“± Install:</strong> Install sebagai app untuk offline gaming</li>
                    <li><strong>ğŸ“Š Statistics:</strong> Lihat record kemenangan dan statistik</li>
                </ul>
                
                <p><strong>ğŸ® Selamat Bermain dan Gunakan Strategi Terbaik Anda!</strong></p>
            </div>
        </div>
    </div>
    
    <!-- Modal Input Nama Pemain -->
    <div class="player-name-modal" id="player-name-modal">
        <div class="modal-content">
            <h2>Pilih Mode Permainan</h2>
            
            <!-- Mode Selection -->
            <div class="game-mode-selection">
                <h3>ğŸ® Mode Permainan:</h3>
                <div class="mode-buttons">
                    <button class="mode-btn active" onclick="selectGameMode('human')" id="human-mode-btn">
                        ğŸ‘¥ Human vs Human
                    </button>
                    <button class="mode-btn" onclick="selectGameMode('ai')" id="ai-mode-btn">
                        ğŸ¤– Human vs AI
                    </button>
                </div>
            </div>
            
            <!-- AI Difficulty Selection (hidden by default) -->
            <div class="ai-difficulty-selection" id="ai-difficulty-section" style="display: none;">
                <h3>ğŸ¯ Tahap Kesukaran AI:</h3>
                <div class="difficulty-buttons">
                    <button class="diff-btn" onclick="selectAIDifficulty('easy')" id="easy-btn">
                        ğŸ˜Š Mudah<br><small>(10 kepungan)</small>
                    </button>
                    <button class="diff-btn active" onclick="selectAIDifficulty('medium')" id="medium-btn">
                        ğŸ˜ Sederhana<br><small>(12 kepungan)</small>
                    </button>
                    <button class="diff-btn" onclick="selectAIDifficulty('hard')" id="hard-btn">
                        ğŸ˜ˆ Sukar<br><small>(14 kepungan)</small>
                    </button>
                </div>
            </div>
            
            <!-- Human vs Human Difficulty Selection -->
            <div class="ai-difficulty-selection" id="human-difficulty-section" style="display: block;">
                <h3>ğŸ¯ Tahap Kesukaran Permainan:</h3>
                <div class="difficulty-buttons">
                    <button class="diff-btn" onclick="selectHumanDifficulty('easy')" id="human-easy-btn">
                        ğŸ˜Š Mudah<br><small>(10 kepungan)</small>
                    </button>
                    <button class="diff-btn active" onclick="selectHumanDifficulty('medium')" id="human-medium-btn">
                        ğŸ˜ Sederhana<br><small>(12 kepungan)</small>
                    </button>
                    <button class="diff-btn" onclick="selectHumanDifficulty('hard')" id="human-hard-btn">
                        ğŸ˜ˆ Sukar<br><small>(14 kepungan)</small>
                    </button>
                </div>
            </div>
            
            <div class="player-input">
                <label for="player1-name">Nama Pemain 1 (Hitam):</label>
                <input type="text" id="player1-name" placeholder="Masukkan nama pemain 1" maxlength="20">
            </div>
            <div class="player-input" id="player2-input">
                <label for="player2-name">Nama Pemain 2 (Merah):</label>
                <input type="text" id="player2-name" placeholder="Masukkan nama pemain 2" maxlength="20">
            </div>
            <div class="modal-buttons">
                <button onclick="startGameWithNames()">Mula Permainan</button>
                <button onclick="useDefaultNames()" class="secondary">Guna Nama Default</button>
            </div>
        </div>
    </div>
    
    <script src="script.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        // Register Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(function(registration) {
                        console.log('âœ… Service Worker registered successfully:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', function() {
                            const newWorker = registration.installing;
                            console.log('ğŸ”„ New Service Worker installing...');
                            
                            newWorker.addEventListener('statechange', function() {
                                if (newWorker.state === 'installed') {
                                    if (navigator.serviceWorker.controller) {
                                        console.log('ğŸ†• New content available, please refresh!');
                                        // Optionally show update notification to user
                                    } else {
                                        console.log('ğŸ“¦ Content cached for offline use!');
                                    }
                                }
                            });
                        });
                    })
                    .catch(function(error) {
                        console.log('âŒ Service Worker registration failed:', error);
                    });
                
                // Handle service worker messages
                navigator.serviceWorker.addEventListener('message', function(event) {
                    console.log('ğŸ“¨ Message from Service Worker:', event.data);
                });
                
                // Request service worker version info
                if (navigator.serviceWorker.controller) {
                    const messageChannel = new MessageChannel();
                    messageChannel.port1.onmessage = function(event) {
                        console.log('ğŸ“Š Service Worker info:', event.data);
                    };
                    navigator.serviceWorker.controller.postMessage({
                        type: 'GET_VERSION'
                    }, [messageChannel.port2]);
                }
            });
        } else {
            console.log('âŒ Service Workers not supported in this browser');
        }
        
        // Handle app install prompt
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', function(e) {
            console.log('ğŸ¯ Install prompt available');
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            
            // Show custom install button
            showInstallButton();
        });
        
        window.addEventListener('appinstalled', function(e) {
            console.log('ğŸ‰ App installed successfully!');
            // Hide install button if shown
            hideInstallButton();
        });
        
        // Function to trigger install prompt (can be called from button)
        function triggerInstall() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(function(choiceResult) {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('âœ… User accepted the install prompt');
                        hideInstallButton();
                    } else {
                        console.log('âŒ User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                });
            } else {
                // Fallback: Show instructions for manual installation
                showInstallInstructions();
            }
        }
        
        // Install button functions
        function showInstallButton() {
            const installButton = document.getElementById('install-button');
            if (installButton && !isStandalone()) {
                installButton.style.display = 'flex';
                console.log('ğŸ“± Install button shown');
            }
        }
        
        function hideInstallButton() {
            const installButton = document.getElementById('install-button');
            if (installButton) {
                installButton.style.display = 'none';
                console.log('ğŸ“± Install button hidden');
            }
        }
        
        function installApp() {
            triggerInstall();
        }
        
        function showInstallInstructions() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            
            let instructions = '';
            
            if (isIOS) {
                instructions = 'ğŸ“± Untuk install di iOS:\n1. Tap Share button (â¬†ï¸) di Safari\n2. Pilih "Add to Home Screen"\n3. Tap "Add"';
            } else if (isAndroid) {
                instructions = 'ğŸ“± Untuk install di Android:\n1. Tap menu (â‹®) di browser\n2. Pilih "Add to Home Screen" atau "Install App"\n3. Tap "Add"';
            } else {
                instructions = 'ğŸ’» Untuk install di Desktop:\n1. Klik icon install di address bar\n2. Atau gunakan menu browser > Install App\n3. Follow the prompts';
            }
            
            alert(instructions);
        }
        
        // Detect if app is running in standalone mode (installed)
        function isStandalone() {
            return (window.matchMedia('(display-mode: standalone)').matches) || 
                   (window.navigator.standalone) || 
                   document.referrer.includes('android-app://');
        }
        
        if (isStandalone()) {
            console.log('ğŸš€ App is running in standalone mode (installed)');
            // Hide install button since app is already installed
            hideInstallButton();
        } else {
            // Show install button after a delay to check for beforeinstallprompt
            setTimeout(function() {
                if (!deferredPrompt) {
                    // No install prompt available, show button anyway for manual instructions
                    showInstallButton();
                }
            }, 2000);
        }
    </script>
</body>
</html>
